const connection = require('./connection');

async function getAll() {
  const [ users ] = await connection.execute('SELECT id, name, cpf, email FROM user');

  return users;
}

async function getOne(id) {
  // PROIBIDO FAZER DESSA FORMA. SUJEITO A PAULADA e PEDRADA.
  // const [ user ] = await connection.execute(`SELECT * FROM user WHERE id = ${id}`);
  const [ user ] = await connection.execute(`SELECT id, name, cpf, email FROM user WHERE id = ?`, [id]);

  return user;
}

async function create({ name, cpf, email, password }) {
  const [ { insertId } ] = await connection.execute(`INSERT INTO user (name, cpf, email, password)
    VALUES (?, ?, ?, ?)
  `, [name, cpf, email, password]);

  return { id: insertId, name, cpf, email, password }
}

async function update(id, { name, cpf, email, password }) {
  await connection.execute(`
    UPDATE user SET name = ?, email = ?, password = ?, cpf = ? WHERE id = ?`,
  [name, email, password, cpf, id]);
}

function deleteOne(id) {
  return connection.execute("DELETE FROM user WHERE id = ?", [id]);
}

module.exports = { getAll, create, update, deleteOne, getOne };